import { useEffect, useState } from 'react';
import Head from 'next/head';
import { useRouter } from 'next/router';
import { BSON } from 'realm-web';
import { MDXRemote } from 'next-mdx-remote';
import { serialize } from 'next-mdx-remote/serialize';
import useRealmStore, { userTypes } from '../../hooks/useRealmStore';
import { Editor } from '../../components/shared/Editor/Editor';
import { Layout } from '../../components/shared/Layout/Layout';
import { components } from '../../components/mdx/allComponents';
import { NoteForVisitor } from '../../components/NotePage/NoteForVisitor/NoteForVisitor';
import { NoteForAdmin } from '../../components/NotePage/NoteForAdmin/NoteForAdmin';
import useEditorStore from '../../components/shared/Editor/useEditorStore';

const { ObjectId } = BSON;

export default function NotePage() {
	const router = useRouter();
	const { noteId } = router.query;

	const userType = useRealmStore((state) => state.userType);
	const db = useRealmStore((state) => state.db);

	// const setValues = useEditorStore((state) => state.setValues);
	const [note, setNote] = useState(null);

	useEffect(() => {
		(async () => {
			if (db) {
				const fetchedNote = await db
					.collection('notes')
					.findOne({ _id: ObjectId(noteId) });
				setNote(fetchedNote);
				// setValues({ title, content, categoryName, isPublic });
			}
		})();
	}, [db]);

	return (
		<>
			<Head>
				<title>Create Next App</title>
				<meta name="description" content="Generated by create next app" />
				<link rel="icon" href="/favicon.ico" />
			</Head>
			{userType === userTypes.admin ? (
				<NoteForAdmin {...note} />
			) : (
				<NoteForVisitor {...note} />
			)}
		</>
	);
}
